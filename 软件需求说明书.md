### **IKUN 通信调试平台 - 软件需求说明书 (SRS)**

**版本: 1.0** 

**日期: 2025-10-10**

#### **1. 引言**

##### **1.1 目的**

本文档旨在详细说明 “IKUN 通信调试平台” 的功能性与非功能性需求。它将作为项目团队（包括开发、测试和产品管理）进行设计、实现和验证的共同基础。

##### **1.2 项目范围**

本项目旨在开发一款现代化、功能丰富且高度可扩展的桌面应用程序，为嵌入式和物联网（IoT）领域的开发者提供一站式的通信调试解决方案。软件核心功能覆盖**串口通信**、**TCP/IP 网络通信**、**Modbus RTU 协议**，并通过集成的**动态脚本引擎**和**专业级数据可视化**能力，满足复杂和私有协议的调试需求。

##### **1.3 术语与缩写**

- **UI**: 用户界面 (User Interface)
- **TCP**: 传输控制协议 (Transmission Control Protocol)
- **Modbus RTU**: 基于串口通信的 Modbus 协议
- **CRC**: 循环冗余校验 (Cyclic Redundancy Check)
- **HEX**: 十六进制 (Hexadecimal)
- **ASCII**: 美国信息交换标准代码 (American Standard Code for Information Interchange)
- **QSS**: Qt 样式表 (Qt Style Sheets)

#### **2. 整体描述**

##### **2.1 产品愿景**

本产品是一款面向开发者的专业工具，旨在取代功能零散、界面陈旧的传统调试软件。它通过现代化的 UI 设计、强大的底层架构和无与伦比的扩展性，提升开发与调试效率，改善用户体验。

##### **2.2 产品功能概述**

- **多功能通信**: 支持串口、TCP 客户端/服务器和 Modbus RTU 协议。
- **数据监控**: 提供灵活的数据收发、格式转换和实时显示。
- **数据可视化**: 通过 ECharts 实现高性能的多通道实时波形绘制。
- **动态协议解析**: 内置 JavaScript 引擎，允许用户自定义任意通信协议的解析逻辑。
- **现代化 UI**: 提供美观、易用、高度可定制的图形用户界面。

##### **2.3 用户群体**

- 嵌入式软件工程师
- 物联网设备开发者
- 自动化工程师
- 硬件工程师
- 计算机专业的学生和爱好者

#### **3. 具体需求**

##### **3.1 功能需求 (Functional Requirements)**

###### **FR-1: 核心框架与主界面**

- **FR-1.1**: 应用程序主窗口应为自定义的无边框窗口，支持拖拽移动和边缘缩放。
- **FR-1.2**: 主窗口需包含自定义标题栏，标题栏上应有应用程序 Logo、标题、最小化、最大化/还原和关闭按钮。
- **FR-1.3**: 应用启动时应显示一个专业的启动画面（SplashScreen），以提升用户体验。
- **FR-1.4**: 主界面核心功能区需采用标签页（Tab）布局，至少包含“串口/TCP”、“Modbus”、“波形”、“设置”四个主要功能模块。

###### **FR-2: 串口通信功能** (`SerialPortConfigTab`)

- **FR-2.1 连接配置** (`SerialPortConnectConfigWidget`):
  - **FR-2.1.1**: 系统必须能自动检测并以列表形式展示当前可用的串口号。
  - **FR-2.1.2**: 用户必须可以配置以下串口参数：波特率、数据位、校验位、停止位和流控制。
  - **FR-2.1.3**: 提供“打开串口”和“关闭串口”的控制按钮，并实时显示连接状态。
- **FR-2.2 数据接收** (`SerialPortReceiveSettingsWidget`, `SerialPortDataReceiveWidget`):
  - **FR-2.2.1**: 接收区必须能以 ASCII 和 HEX 两种格式显示数据，并允许用户随时切换。
  - **FR-2.2.2**: 必须提供“显示时间戳”选项，选中后每条数据前都应附带 `[HH:mm:ss.zzz]` 格式的时间信息。
  - **FR-2.2.3**: 必须提供“自动滚动”功能，使接收区始终显示最新的数据。
  - **FR-2.2.4**: 提供“清除接收”按钮，用于清空数据接收区的内容。
- **FR-2.3 数据发送** (`SerialPortSendSettingsWidget`, `SerialPortDataSendWidget`):
  - **FR-2.3.1**: 用户可以在发送区输入文本或十六进制字符串进行发送。
  - **FR-2.3.2**: 必须支持“HEX发送”模式，在该模式下，发送区内的文本将被解析为十六进制数据发送。
  - **FR-2.3.3**: 必须提供“定时发送”功能，允许用户设置发送周期（毫秒），并自动重复发送。
- **FR-2.4 数据存储** (`SerialPortRealTimeSaveWidget`):
  - **FR-2.4.1**: 必须提供“实时保存”功能，将接收到的数据实时写入到用户指定的日志文件中。

###### **FR-3: TCP/IP 网络通信功能** (`TcpNetworkConfigTab`)

- **FR-3.1 模式选择**: 用户必须可以在“TCP客户端”和“TCP服务器”两种模式间切换。
- **FR-3.2 TCP 客户端模式** (`TcpNetworkClientWidget`):
  - **FR-3.2.1**: 用户必须可以输入目标服务器的 IP 地址和端口号。
  - **FR-3.2.2**: 提供“连接”和“断开”按钮，并实时显示与服务器的连接状态。
  - **FR-3.2.3**: 数据收发功能（HEX/ASCII、时间戳、定时发送等）应与串口模块保持一致。
- **FR-3.3 TCP 服务器模式** (`TcpNetworkServerWidget`):
  - **FR-3.3.1**: 用户必须可以设置监听的本地端口号。
  - **FR-3.3.2**: 提供“开始监听”和“停止监听”的控制按钮。
  - **FR-3.3.3**: 必须能同时处理多个客户端的连接请求，并在界面上展示客户端列表（IP:Port）。
  - **FR-3.3.4**: 服务器发送数据时，用户必须可以选择向“所有客户端”（广播）或“指定的单个客户端”发送。
  - **FR-3.3.5**: 接收到的数据前必须自动添加来源信息（如 `from 192.168.1.100:12345:`），以区分不同客户端的数据。

###### **FR-4: Modbus RTU 功能** (`ModbusConfigTab`)

- **FR-4.1 协议核心** (`ModbusController`):
  - **FR-4.1.1**: 必须实现 Modbus RTU 协议的完整主站（Master）功能。
  - **FR-4.1.2**: 必须支持以下功能码：`0x03` (读保持寄存器), `0x06` (写单个寄存器), `0x10` (写多个寄存器)。
  - **FR-4.1.3**: 所有发出的请求和接收的响应都必须进行 CRC-16 校验。
- **FR-4.2 点位管理** (`TagManagerDialog`):
  - **FR-4.2.1**: 必须提供一个可视化的点位（Tag）管理界面，支持对点位的增、删、改、查操作。
  - **FR-4.2.2**: 创建或编辑点位时 (`AddEditModbusTagDialog`)，必须允许用户配置以下参数：点位名称、从站 ID、功能码、寄存器地址、数据类型。
  - **FR-4.2.3**: 数据类型必须支持：`UInt16`, `Int16`, `UInt32`, `Int32`, `Float32`。
  - **FR-4.2.4**: 针对 32 位数据类型，必须支持四种字节序（Endianness）的配置：大端 (ABCD)、小端 (DCBA)、字节交换 (BADC/CDAB)。
  - **FR-4.2.5**: 必须支持为每个点位配置增益（Gain）和偏移量（Offset），用于原始值到工程值的线性转换。
- **FR-4.3 操作与显示** (`ModbusDisplayWidget`):
  - **FR-4.3.1**: 主界面必须以表格形式实时展示所有已配置点位的名称、地址、值和状态。
  - **FR-4.3.2**: 用户可以直接在表格中修改可写点位的值，并触发 `0x06` 或 `0x10` 写操作。
  - **FR-4.3.3**: 必须提供“自动轮询”功能，允许用户设置轮询周期，软件将自动循环读取所有配置的点位数据。
  - **FR-4.3.4**: 必须有一个通信日志窗口，用于显示原始的 Modbus 请求和响应报文（HEX格式），便于调试。

###### **FR-5: 数据可视化功能** (`WaveformTab`)

- **FR-5.1 波形图表** (`WaveformWidget`):
  - **FR-5.1.1**: 必须内嵌一个基于 ECharts 的高性能图表组件，用于实时绘制数据波形。
  - **FR-5.1.2**: 图表必须支持同时显示多个数据通道，每个通道的颜色应不同。
- **FR-5.2 通道管理** (`ChannelManager`, `WaveformCtrlWidget`):
  - **FR-5.2.1**: 用户必须可以动态地“添加通道” (`AddChannelDialog`)。添加时需指定通道名称、通道ID（用于与数据源关联）和颜色。
  - **FR-5.2.2**: 用户必须可以从列表中选择并“移除通道” (`RemoveChannelDialog`)。
  - **FR-5.2.3**: 提供“开始/停止录波”和“清除图表”的功能按钮。
- **FR-5.3 数据源**:
  - **FR-5.3.1**: 录波数据必须能够来源于串口或 TCP 网络。
  - **FR-5.3.2**: 默认的数据协议为基于文本的键值对格式，如 `ChannelID1=Value1,ChannelID2=Value2,`。
- **FR-5.4 采样率配置** (`SampleRateDialog`):
  - **FR-5.4.1**: 必须允许用户配置图表的时间轴增量，即采样率，以控制波形横轴的步进。

###### **FR-6: 动态脚本引擎功能** (`ScriptManager`)

- **FR-6.1 脚本编辑器** (`ScriptEditorDialog`):
  - **FR-6.1.1**: 必须提供一个内置的 JavaScript 代码编辑器。
  - **FR-6.1.2**: 编辑器必须支持 JavaScript 语法高亮。
  - **FR-6.1.3**: 编辑器应支持深色和浅色两种主题模式切换。
- **FR-6.2 脚本执行**:
  - **FR-6.2.1**: 用户可以选择为串口、TCP 客户端、TCP 服务器分别启用或禁用自定义脚本。
  - **FR-6.2.2**: 启用后，所有原始的、未经处理的通信数据都将优先送入用户脚本进行解析。
  - **FR-6.2.3**: 脚本必须能处理二进制和文本数据，允许用户实现任意私有协议的解析。
- **FR-6.3 脚本 API**:
  - **FR-6.3.1**: 必须向脚本环境暴露一个核心的 `processBuffer(buffer, context)` 函数接口。
  - **FR-6.3.2**: `buffer` 参数为 C++ 传入的原始数据 (`QByteArray`)。
  - **FR-6.3.3**: `context` 参数为一个对象，至少包含 `source` 属性，用于告知脚本数据来源（如 "COM1" 或 "192.168.1.100:12345"）。
  - **FR-6.3.4**: 脚本的返回值必须是一个包含 `bytesConsumed` 和 `frames` 两个属性的对象，用于告知 C++ 侧消耗的字节数和解析出的数据帧数组。
  - **FR-6.3.5**: 解析出的数据帧对象可以包含 `displayText` (用于文本显示) 和 `chartData` (用于波形绘制) 两个可选属性。

##### **3.2 非功能性需求 (Non-functional Requirements)**

###### **NFR-1: 性能**

- **NFR-1.1 响应性**: 即使在 115200 波特率的串口数据流或高频 TCP 数据流下，UI 界面也必须保持流畅，对用户的点击、拖拽等操作的响应时间应小于 100 毫秒。
- **NFR-1.2 数据处理**: 核心数据处理逻辑（`PacketProcessor`）必须在独立的非 UI 线程中执行，以避免阻塞主线程。
- **NFR-1.3 CPU 占用**: 在无数据收发时，消费者线程应通过 `QWaitCondition` 挂起，以避免空轮询，将 CPU 占用率降至最低。
- **NFR-1.4 可视化刷新率**: ECharts 波形图表的刷新率应力求达到 60FPS，数据更新应采用批量处理机制以优化 C++/JS 通信性能。

###### **NFR-2: 可靠性与健壮性**

- **NFR-2.1 线程安全**: 所有跨线程共享的数据（如数据队列）必须使用 `QMutex` 等同步原语进行保护，确保数据一致性。
- **NFR-2.2 内存管理**: 必须为数据缓冲区设置上限，防止在极端数据流下因数据积压导致内存无限增长而崩溃。
- **NFR-2.3 错误处理**: 必须能正确处理串口打开失败、TCP 连接断开、Modbus 响应超时或异常响应等情况，并向用户提供清晰的错误提示。
- **NFR-2.4 硬件热拔插**: 应用程序应能应对串口设备的物理拔出和插入，并能刷新可用串口列表。

###### **NFR-3: 易用性**

- **NFR-3.1 界面**: UI 界面应布局清晰、图标表意明确、操作逻辑符合用户习惯。
- **NFR-3.2 反馈**: 所有的操作都应有即时的视觉反馈（如按钮状态变化、状态栏文本更新等）。
- **NFR-3.3 文档**: 必须提供清晰的 `README.md` 文档，包含功能介绍、使用说明和脚本示例。

###### **NFR-4: 可维护性与可扩展性**

- **NFR-4.1 代码结构**: 项目必须遵循清晰的分层架构（UI、Core、Utils），模块之间应高内聚、低耦合。
- **NFR-4.2 样式**: 界面样式应与逻辑分离，通过外部 QSS 文件进行定义，便于主题更换和样式维护。
- **NFR-4.3 扩展性**: 系统的核心扩展能力依赖于脚本引擎，其 API 设计应保持稳定和通用。

###### **NFR-5: 部署**

- **NFR-5.1 Windows 部署**: 必须提供一键部署脚本 (`deploy.bat`)，能自动将所有 Qt 依赖项（DLLs、插件）打包到可执行文件目录，形成绿色免安装应用。
- **NFR-5.2 构建系统**: 项目必须使用 CMake 进行构建，以保证跨平台开发的潜力。